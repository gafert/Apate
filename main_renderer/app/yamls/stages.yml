# Descriptions per stages

# FETCH
- instr: [] # If this infoText is on depending on the instruction, empty is all
  start: fetch # Defines where the stage starts, see CPU_STATE_IDS
  infos:
    - text: Load new instruction at location of program counter # The text displayed
      highlight: [p_pc-0001, s_pc-0002] # The elements that should be highlighted
      focusArea: overview # focusArea to go to, will be appended with areaborder_
      focusElement: fetch # focusElement to go to after focusArea has been selected, will be appended with focus_
      exec: fetch # If the cpu should execute
    - text: Pass values into decoder
      highlight: [s_instrmemread-0000]
      focusElement: fetchpass
# DECODE
- instr: []
  start: decode
  infos:
    - text: Control Unit
      highlight: []
      from: m_controlunit
      focusArea: cu
      exec: decode
    - text: Get instruction group by opcode
      highlight: []
      focusElement: cu_instr_group
    - text: Get all values which are at fixed locations in the current instruction
      highlight: []
      focusElement: cu_static_values
    - text: Depending on the instruction the Immediate value resides on different bit combinations
      highlight: []
      focusElement: cu_immediates
    - text: Store the name of the instruction to the Instruction Signal. The name of the instruction depends on the opcode, func3, func7 and sometimes the Immediate value
      highlight: [ ]
      focusElement: cu_instruction
- instr: [op, imm, load, jalr, store, branch]
  infos:
    - text: Get values stored in the Registers from the given addresses
      focusArea: overview
      focusElement: decoderregisters
      highlight: [m_reg2-0080, m_reg1-0077]
- instr: []
  infos:
    - text: Pass values to the Data- and Control Path to activate the correct paths
      focusElement: decoderpass
      focusArea: overview
      highlight: [s_instr-0064, m_controlpath-0074, w_op-0066, w_imminstr-0065, w_load-0067, w_branch-0069, w_jal-0070, w_jalr-0071, w_lui-0072, w_auipc-0073, s_rd-0082, s_imm-0081, m_datapath-0083]
# EXECUTE
- instr: [imm]
  start: execute
  infos:
    - text: Pass Immediate into Operator 1
      highlight: [p_imm-0009, s_imm-0008, m_mux_immrs2-0004, s_immrs2-0005, m_mux_immrs2pcimm-0019, s_op1-0014]
      focusElement: alu
    - text: Pass Register Source 1 into Operator 2
      highlight: [p_rs1-0033, s_rs1-0032, m_mux_rs1412-0020, s_op2-00163]
- instr: [op]
  infos:
    - text: Pass Register Source 2 into Operator 1 of ALU
      focusElement: alu
      highlight: [p_rs2-0006, s_rs2-0007, m_mux_immrs2-0004, s_immrs2-0005, m_mux_immrs2pcimm-0019, s_op1-0014]
    - text: Pass Register Source 1 into Operator 2 of ALU
      highlight: [p_rs1-0033, s_rs1-0032, m_mux_rs1412-0020, s_op2-0016]
- instr: [jal, jalr]
  infos:
    - text: Pass Program Counter into Operator 1
      focusElement: alu
      highlight: [p_pc-0026, s_pc-0027, m_mux_immrs2pcimm-0019, s_op1-0014]
    - text: Pass 4 into Operator 2
      highlight: []
- instr: [lui, auipc]
  infos:
    - text: Pass Immediate into Operator 1
      focusElement: alu
      highlight: [p_imm-0024, s_imm-0025, m_mux_immrs2pcimm-0019, s_op1-0014]
    - text: Pass 12 into Operator 2
      highlight: [p_12-0028, s_12-0029, m_mux_rs1412-0020, s_op2-0016]
- instr: [imm, op, jal, jalr, lui, auipc]
  infos:
    - text: Arithemtic Logic Unit (ALU)
      focusArea: alu
      highlight: [ ]
    - text: Calculate
      exec: execute
      highlight: [ ]
    - text: Overview
      focusArea: overview
      focusElement: alu
      highlight: [ ]
- instr: [auipc]
  infos:
    - text: Add output of ALU to Program Counter and pass it to the next stage
      focusElement: alu
      highlight: [p_pc-0011, s_pc-0012, m_addpcalu-0010, s_pcaluout-0013, m_mux_pcaluout-0017]
- instr: [imm, op, jal, jalr, lui]
  infos:
    - text: Pass ALU Output to the next stage
      focusElement: alu
      highlight: [s_aluout-0018, m_mux_pcaluout-0017, s_regwrite]
- instr: [auipc]
  infos:
    - text: Add output of ALU to Program Counter and pass it to the next stage
      focusElement: alu
      highlight: []
- instr: [store]
  infos:
    - text: Add Register Source 1 and Immediate to generate the memory address
      focusElement: memory
      highlight: []
    - text: Pass Register Source 2 as the data to be written to the memory
      highlight: []
    - text: Store the value in the memory, watch the memory in the next cycle
      highlight: []
    - text: Stored data
      exec: execute
      highlight: []
- instr: [load]
  infos:
    - text: Add Register Source 1 and Immediate to generate the memory address
      focusElement: memory
      highlight: []
    - text: Load value from memory
      exec: execute
      highlight: []
    - text: Pass read value to the next stage
      focusElement: memorypass
      highlight: []
- instr: [branch]
  infos:
    - text: Pass Register Source 1 and Register Source 2 to the Branch Evaluator
      highlight: []
      focusElement: branch
      exec: execute
    - text: Calculate the output and select the correct signal
      highlight: []
      focusArea: be
- instr: [branch]
  if: !!js/function  'function (bindings) { return bindings.branchResult.value == true; }'
  infos:
    - text: Use the result from the comparator to select Immediate and pass it the next stage
      focusArea: overview
      focusElement: branchpass
      highlight: []
- instr: [branch]
  if: !!js/function  'function (bindings) { return bindings.branchResult.value == false; }'
  infos:
    - text: Use the result from the comparator to select 4 and pass it the next stage
      focusElement: branchpass
      focusArea: overview
      highlight: []
# WRITE BACK
- instr: [load, imm, op, jal, jalr, lui, auipc]
  start: writeback
  infos:
    - text: Store passed value to the Register at the location of Return Register. Watch the Register at RD change in the next cycle.
      focusElement: writeback
      highlight: []
    - text: Stored value at Return Address (RD)
      highlight: []
      exec: writeback
- instr: [branch]
  infos:
    - text: Nothing to be done in writeback on BRANCH calls
      focusElement: writeback
      exec: writeback
      highlight: []
- instr: [store]
  infos:
    - text: Nothing to be done in writeback on STORE instruction
      focusElement: writeback
      exec: writeback
      highlight: []
# ADVANCE PROGRAM COUNTER
- instr: [branch]
  start: advanceprogramcounter
  infos:
    - text: Pass Branch Result (4 or Immediate) to be added to the current Program Counter and set to the new Program Counter
      focusElement: pc
      highlight: []
- instr: [jal]
  infos:
    - text: Pass Immediate to be added to the current Program Counter and set to the new Program Counter
      focusElement: pc
      highlight: []
- instr: [jalr]
  infos:
    - text: Add Register Source 1 and Immediate to set the new Program Counter
      focusElement: pc
      highlight: []
- instr: [store, imm, op, lui, load, auipc]
  infos:
    - text: Pass 4 to be added to the current Program Counter and set to the new Program Counter
      focusElement: pc
      highlight: []
- instr: []
  infos:
    - text: Set new program counter. Watch the PC change in the 'Instructions' Panel on the right.
      highlight: []
- instr: []
  infos:
    - text: New Program Counter set. Cycle completed.
      exec: advanceprogramcounter
      highlight: []
